# ===================================================
# --- Limits & Timeouts ---
# ===================================================
client_max_body_size 1G;
client_body_buffer_size 400M;
proxy_connect_timeout 1500;
proxy_send_timeout 1500;
proxy_read_timeout 1500;

# ===================================================
# --- Buffers ---
# ===================================================
proxy_buffer_size 128k;
proxy_buffers 4 256k;
proxy_busy_buffers_size 256k;
proxy_headers_hash_max_size 1024;
proxy_headers_hash_bucket_size 128;

# ===================================================
# --- Real IP Handling ---
# ===================================================
real_ip_header CF-Connecting-IP;
real_ip_recursive on;

# ===================================================
# --- Log format personnalis√© ---
# ===================================================
log_format realip '$remote_addr - $remote_user [$time_local] '
                  '"$request" $status $body_bytes_sent '
                  '"$http_referer" "$http_user_agent" '
                  'CF-IP:$http_cf_connecting_ip '
                  'Proto:$http_x_forwarded_proto';

access_log /var/log/nginx/access.log realip;